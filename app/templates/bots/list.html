{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col s12">
            <h4>Your Telegram Bots</h4>
            <a href="{{ url_for('bots.register') }}" class="waves-effect waves-light btn">
                <i class="material-icons left">add</i>Register New Bot
            </a>
        </div>
    </div>

    <div class="row">
        {% for bot in bots %}
        <div class="col s12 m6">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">{{ bot.bot_username or 'Unnamed Bot' }}</span>
                    <p>Status: 
                        {% if bot.is_active %}
                        <span class="green-text">Active</span>
                        {% else %}
                        <span class="red-text">Inactive</span>
                        {% endif %}
                    </p>
                    <p>Last Activity: {{ bot.last_activity.strftime('%Y-%m-%d %H:%M:%S') if bot.last_activity else 'Never' }}</p>
                </div>
                <div class="card-action">
                    <a href="#" class="check-status" data-bot-id="{{ bot.id }}">Check Status</a>
                    <a href="#" class="configure-bot" data-bot-id="{{ bot.id }}">Configure</a>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col s12">
            <div class="card-panel">
                <span>You haven't registered any bots yet. Click the button above to get started!</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Materialize components
    M.AutoInit();

    // Add click handlers for status checks
    document.querySelectorAll('.check-status').forEach(function(element) {
        element.addEventListener('click', function(e) {
            e.preventDefault();
            const botId = this.getAttribute('data-bot-id');
            checkBotStatus(botId);
        });
    });
});

function checkBotStatus(botId) {
    fetch(`/bots/${botId}/status`)
        .then(response => response.json())
        .then(data => {
            M.toast({html: `Checking status for bot ${botId}...`});
        })
        .catch(error => {
            M.toast({html: 'Error checking bot status'});
            console.error('Error:', error);
        });
}
</script>
{% endblock %}
{% endblock %}